<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jj.myssm.dao.IFilmsDAO">
    <resultMap id="film_act" type="film">
        <result property="filmid" column="filmid"></result>
        <collection property="acts" column="filmid" select="findActorByFilmid"></collection>
    </resultMap>
    <select id="findAllFilms" parameterType="film" resultMap="film_act" >
        select f.*,ifnull(t.tn,0) ticknum from films f left join
          (select filmid,sum(ticketnum) tn from tickets group by filmid) t on f.filmid=t.filmid
          <where>
              <if test="filmname != null">
                  filmname like concat('%',#{filmname},'%')
              </if>
          </where>
           order by t.tn desc
    </select>
    <select id="findActorByFilmid" parameterType="int" resultType="act">
        select * from actors where filmid=#{filmid}
    </select>
</mapper>